(()=>{"use strict";var e={8:(e,t)=>{function o(e){return new Promise(((t,o)=>{chrome.storage.local.get(e,(e=>{if(chrome.runtime.lastError)return o(chrome.runtime.lastError);t(e)}))}))}function n(e){return new Promise(((t,o)=>{chrome.storage.local.set(e,(()=>{if(chrome.runtime.lastError)return o(chrome.runtime.lastError);t()}))}))}async function r(){const{focusState:e}=await o(["focusState"]);return Object.assign(Object.assign({},{active:!1,allowedContexts:[]}),e)}Object.defineProperty(t,"__esModule",{value:!0}),t.setFocusState=t.getFocusState=t.addContextToHistory=t.setStorage=t.getStorage=void 0,t.getStorage=o,t.setStorage=n,t.addContextToHistory=async function(e,t,r){const{contextHistory:i}=await o(["contextHistory"]),c=i||[];c.push({context:e,url:t,timestamp:Date.now(),confidence:r}),c.length>100&&c.shift(),await n({contextHistory:c})},t.getFocusState=r,t.setFocusState=async function(e){const t=await r();await n({focusState:Object.assign(Object.assign({},t),e)})}},18:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getContextTracker=t.classifyPageContext=t.extractPageData=t.extractMetadata=t.initializeContextEngine=void 0;const n=o(309),r=o(578),i=o(357),c=new r.TextClassifier,a=new i.ContextTracker;let s=!1;async function l(){if(!s)try{await c.initialize(),console.log("[Context] Context engine initialized successfully"),s=!0}catch(e){console.error("[Context] Failed to initialize context engine:",e)}}function m(){let e="",t=[];const o=document.querySelector('meta[name="description"]');o&&(e=o.getAttribute("content")||"");const n=document.querySelector('meta[name="keywords"]');return n&&(t=(n.getAttribute("content")||"").split(",").map((e=>e.trim()))),{description:e,keywords:t}}t.initializeContextEngine=l,t.extractMetadata=m,t.extractPageData=function(){const e=m(),t=(0,n.extractDomain)(window.location.href);return{url:window.location.href,title:document.title,fullText:document.body.innerText||"",metaDescription:e.description,metaKeywords:e.keywords,domainCategory:(0,n.getDomainCategory)(t)}},t.classifyPageContext=async function(e){s||await l();const t=function(e){const t=Object.entries(e).filter((([e,t])=>t>0)).sort(((e,t)=>t[1]-e[1]));if(0===t.length)return{primaryContext:"General",confidence:1,secondaryContexts:[]};const[o,n]=t[0];return{primaryContext:o,confidence:n,secondaryContexts:t.slice(1,4).map((([e,t])=>({context:e,confidence:t}))),features:e}}(function(e,t,o){const n=Object.assign({},e);for(const[e,o]of Object.entries(t))n[e]=(n[e]||0)+.3*o;return o&&n[o]&&(n[o]=1.3*n[o]),n}(await c.classify(e.fullText),(0,n.analyzeUrl)(e.url),e.domainCategory));return await a.addContext(t.primaryContext,e.url,t.confidence),t},t.getContextTracker=function(){return a}},309:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.analyzeUrl=t.extractPathKeywords=t.getDomainCategory=t.extractDomain=void 0;const o={"docs.google.com":"Work","sheets.google.com":"Work","slides.google.com":"Work","drive.google.com":"Work","office.com":"Work","microsoft365.com":"Work","linkedin.com":"Work","slack.com":"Work","teams.microsoft.com":"Work","asana.com":"Work","trello.com":"Work","notion.so":"Work","monday.com":"Work","atlassian.com":"Work","jira.com":"Work","basecamp.com":"Work","zoom.us":"Work","coursera.org":"Learning","udemy.com":"Learning","edx.org":"Learning","khanacademy.org":"Learning","duolingo.com":"Learning","canvas.instructure.com":"Learning","blackboard.com":"Learning","quizlet.com":"Learning","chegg.com":"Learning","brilliant.org":"Learning","codecademy.com":"Learning","freecodecamp.org":"Learning","lynda.com":"Learning","skillshare.com":"Learning","pluralsight.com":"Learning","netflix.com":"Entertainment","hulu.com":"Entertainment","disneyplus.com":"Entertainment","hbomax.com":"Entertainment","youtube.com":"Entertainment","twitch.tv":"Entertainment","spotify.com":"Entertainment","pandora.com":"Entertainment","tidal.com":"Entertainment","soundcloud.com":"Entertainment","steam.com":"Entertainment","epicgames.com":"Entertainment","ign.com":"Entertainment","imdb.com":"Entertainment","rottentomatoes.com":"Entertainment","cnn.com":"News","bbc.com":"News","nytimes.com":"News","washingtonpost.com":"News","reuters.com":"News","apnews.com":"News","foxnews.com":"News","nbcnews.com":"News","abcnews.go.com":"News","cbsnews.com":"News","politico.com":"News","economist.com":"News","wsj.com":"News","bloomberg.com":"News","theguardian.com":"News","github.com":"Development","gitlab.com":"Development","bitbucket.org":"Development","stackoverflow.com":"Development","developer.mozilla.org":"Development","w3schools.com":"Development","codepen.io":"Development","replit.com":"Development","codesandbox.io":"Development","jsfiddle.net":"Development","npmjs.com":"Development","pypi.org":"Development","docker.com":"Development","kubernetes.io":"Development","digitalocean.com":"Development","amazon.com":"Shopping","ebay.com":"Shopping","walmart.com":"Shopping","target.com":"Shopping","bestbuy.com":"Shopping","etsy.com":"Shopping","aliexpress.com":"Shopping","wayfair.com":"Shopping","costco.com":"Shopping","newegg.com":"Shopping","homedepot.com":"Shopping","lowes.com":"Shopping","macys.com":"Shopping","nordstrom.com":"Shopping","zappos.com":"Shopping","facebook.com":"Social","twitter.com":"Social","instagram.com":"Social","reddit.com":"Social","pinterest.com":"Social","tumblr.com":"Social","tiktok.com":"Social","snapchat.com":"Social","discord.com":"Social","messenger.com":"Social","telegram.org":"Social","whatsapp.com":"Social","signal.org":"Social","medium.com":"Social","quora.com":"Social","scholar.google.com":"Research","pubmed.ncbi.nlm.nih.gov":"Research","researchgate.net":"Research","academia.edu":"Research","jstor.org":"Research","springer.com":"Research","sciencedirect.com":"Research","ieee.org":"Research","ncbi.nlm.nih.gov":"Research","arxiv.org":"Research","sciencemag.org":"Research","nature.com":"Research","webofknowledge.com":"Research","scopus.com":"Research","mendeley.com":"Research"};function n(e){try{return new URL(e).hostname}catch(e){return console.error("Error extracting domain:",e),""}}function r(e){if(o[e])return o[e];if(e.startsWith("www.")){const t=e.substring(4);if(o[t])return o[t]}const t=e.split(".");if(t.length>2){const e=t.slice(t.length-2).join(".");return o[e]}}function i(e){try{return new URL(e).pathname.split("/").filter(Boolean).flatMap((e=>e.split(/[-_]/).filter((e=>e.length>2))))}catch(e){return console.error("Error extracting path keywords:",e),[]}}t.extractDomain=n,t.getDomainCategory=r,t.extractPathKeywords=i,t.analyzeUrl=function(e){const t=r(n(e)),o=(i(e),{});return t&&(o[t]=.8),o}},357:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ContextTracker=void 0;const n=o(8);t.ContextTracker=class{constructor(){this.latestContext="Unknown",this.latestUrl=""}async addContext(e,t,o){this.latestContext=e,this.latestUrl=t,await(0,n.addContextToHistory)(e,t,o)}async getContextSwitches(e=15){const{contextHistory:t}=await(0,n.getStorage)(["contextHistory"]);if(!t||t.length<2)return[];const o=[],r=Date.now(),i=60*e*1e3,c=t.filter((e=>r-e.timestamp<i));for(let e=1;e<c.length;e++)c[e].context!==c[e-1].context&&o.push({from:c[e-1].context,to:c[e].context,timestamp:c[e].timestamp,fromUrl:c[e-1].url,toUrl:c[e].url});return o}async getCurrentContextStreak(){const{contextHistory:e}=await(0,n.getStorage)(["contextHistory"]);if(!e||0===e.length)return 0;const t=e[e.length-1].context;let o=1;for(let n=e.length-2;n>=0&&e[n].context===t;n--)o++;return o}async isLostFocus(e=5,t=15){const o=await this.getContextSwitches(t);return o.length>=e&&new Set(o.map((e=>e.to))).size>=3}getLatestContext(){return this.latestContext}getLatestUrl(){return this.latestUrl}}},578:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TextClassifier=void 0,t.TextClassifier=class{constructor(){this.initialized=!1,this.categoryKeywords={Work:["project deadline meeting task client report presentation office business email colleague manager workflow productivity professional"],Learning:["course lesson tutorial learn study education assignment homework university college school academy lecture professor student quiz exam test knowledge textbook"],Entertainment:["movie show stream watch video game play fun music song entertainment netflix youtube hulu disney hbo amazon twitch gaming"],News:["news article report breaking headline journalist media press update current politics election government president minister cnn bbc nyt reuters associated"],Shopping:["shop buy purchase order cart checkout price discount product item amazon ebay etsy store mall shipping delivery payment credit review"],Social:["friend message chat post share social network facebook twitter instagram snapchat tiktok linkedin reddit forum comment like follow connect profile"],Research:["research study analysis data information journal article paper science scientific academic scholar experiment theory hypothesis methodology finding conclude reference citation"],Development:["code programming developer software github git repository commit function class method variable object array string stack overflow javascript python typescript"]}}async initialize(){this.initialized=!0}async classify(e){this.initialized||await this.initialize();const t=e.toLowerCase(),o={};for(const[e,n]of Object.entries(this.categoryKeywords)){let r=0;for(const e of n){const o=e.split(" ");let n=0;for(const e of o)t.includes(e)&&(n++,r+=1);n>0&&(r/=.3*o.length)}o[e]=Math.min(1,r)}return o}}}},t={};function o(n){var r=t[n];if(void 0!==r)return r.exports;var i=t[n]={exports:{}};return e[n](i,i.exports,o),i.exports}(()=>{const e=o(18);let t=null;async function n(){new MutationObserver((()=>{document.hidden||r||("requestIdleCallback"in window?window.requestIdleCallback((()=>i()),{timeout:2e3}):i())})).observe(document.body,{childList:!0,subtree:!0,characterData:!0}),await c()}let r=null;function i(){r&&(window.clearTimeout(r),r=null),r=window.setTimeout((async()=>{await c()}),1e3)}async function c(){try{const o=function(){var e,t,o;const n=window.location.href,r=document.title,i=(null===(e=document.querySelector('meta[name="description"]'))||void 0===e?void 0:e.getAttribute("content"))||"",c=(null===(o=null===(t=document.querySelector('meta[name="keywords"]'))||void 0===t?void 0:t.getAttribute("content"))||void 0===o?void 0:o.split(",").map((e=>e.trim())))||[],a=document.querySelectorAll("p, h1, h2, h3, h4, h5, h6, a, span, div, li");let s="";const l=Math.min(a.length,100);for(let e=0;e<l;e++){const t=a[e],o=window.getComputedStyle(t);if("none"!==o.display&&"hidden"!==o.visibility&&(s+=t.textContent+" ",s.length>5e3))break}return{url:n,title:r,fullText:s.trim(),metaDescription:i,metaKeywords:c}}(),n=await(0,e.classifyPageContext)(o);n.primaryContext!==t&&(t=n.primaryContext,chrome.runtime.sendMessage({type:"CONTEXT_DETECTED",context:n.primaryContext,confidence:n.confidence,url:o.url}))}catch(e){console.error("Error detecting context:",e)}}"complete"===document.readyState||"interactive"===document.readyState?n():document.addEventListener("DOMContentLoaded",n),chrome.runtime.onMessage.addListener((e=>{if("DRIFT_WARNING"!==e.type)return;const t=document.getElementById("__cf_drift_overlay");null==t||t.remove();const o=document.createElement("div");o.id="__cf_drift_overlay",o.style.cssText="\n    position:fixed;inset:0;z-index:2147483647;\n    background:rgba(0,0,0,.85);color:#fff;display:flex;\n    flex-direction:column;align-items:center;justify-content:center;\n    font:700 32px/1.4 system-ui, sans-serif;text-align:center;\n  ",o.textContent=e.message||"You're drifting!";const n=document.createElement("button");return n.textContent="Back to focus",n.style.cssText="\n    margin-top:24px;padding:12px 24px;font-size:18px;font-weight:700;\n    border:none;border-radius:6px;cursor:pointer;background:#d32f2f;color:#fff;\n  ",n.onclick=()=>o.remove(),o.appendChild(n),document.documentElement.appendChild(o),!0}))})()})();
//# sourceMappingURL=content.js.map