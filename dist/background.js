(()=>{"use strict";var e={8:(e,t)=>{function o(e){return new Promise(((t,o)=>{chrome.storage.local.get(e,(e=>{if(chrome.runtime.lastError)return o(chrome.runtime.lastError);t(e)}))}))}function a(e){return new Promise(((t,o)=>{chrome.storage.local.set(e,(()=>{if(chrome.runtime.lastError)return o(chrome.runtime.lastError);t()}))}))}async function r(){const{focusState:e}=await o(["focusState"]);return Object.assign(Object.assign({},{active:!1,allowedContexts:[]}),e)}Object.defineProperty(t,"__esModule",{value:!0}),t.setFocusState=t.getFocusState=t.addContextToHistory=t.setStorage=t.getStorage=void 0,t.getStorage=o,t.setStorage=a,t.addContextToHistory=async function(e,t,r){const{contextHistory:n}=await o(["contextHistory"]),s=n||[];s.push({context:e,url:t,timestamp:Date.now(),confidence:r}),s.length>100&&s.shift(),await a({contextHistory:s})},t.getFocusState=r,t.setFocusState=async function(e){const t=await r();await a({focusState:Object.assign(Object.assign({},t),e)})}},18:(e,t)=>{let o;async function a(){try{if(void 0!==o)try{return await chrome.windows.get(o),o}catch(e){o=void 0}const{id:e}=await chrome.windows.create({url:"about:blank",type:"normal",state:"maximized"});if(o=e,e){const t=await chrome.tabs.query({windowId:e});t.length>0&&t[0].id&&await chrome.tabs.update(t[0].id,{url:chrome.runtime.getURL("blocked.html")+"?mode=welcome"})}return o}catch(e){return void console.error("Error launching focus window:",e)}}Object.defineProperty(t,"__esModule",{value:!0}),t.moveTabToFocusWindow=t.getFocusWindowId=t.closeFocusWindow=t.launchFocusWindow=void 0,t.launchFocusWindow=a,t.closeFocusWindow=async function(){if(void 0!==o)try{await chrome.windows.remove(o),o=void 0}catch(e){console.error("Error closing focus window:",e),o=void 0}},t.getFocusWindowId=function(){return o},t.moveTabToFocusWindow=async function(e){if(void 0===o&&void 0===await a())return!1;try{return await chrome.tabs.move(e,{windowId:o,index:-1}),!0}catch(e){return console.error("Error moving tab to focus window:",e),!1}}},56:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.pickColorForContext=void 0,t.pickColorForContext=function(e){switch(e){case"Work":return"yellow";case"Learning":return"blue";case"Entertainment":return"green";case"News":return"red";case"Shopping":return"purple";case"Social":return"cyan";case"Research":return"pink";case"Development":return"orange";default:return"grey"}}},170:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.removeWorkspace=t.saveCurrentWorkspace=t.restoreWorkspace=t.getTimeLeft=t.isActive=t.isBlocked=t.end=t.start=void 0;const a=o(8),r=o(282),n=o(18),s=o(569),c=o(591);let i,l=!1;t.start=async function(e,t){var o;const s=Array.isArray(e)?e:[],c=t?Date.now()+60*t*1e3:void 0;await(0,a.setFocusState)({active:!0,allowedContexts:s,endTime:c});const i=["Work","Development","Research","Learning","Entertainment","Social","Shopping","News"].filter((e=>!s.includes(e)));await(0,a.setStorage)({blockedCategories:i}),await(0,r.openSidePanel)(),!!(null===(o=(await(0,a.getStorage)(["focusSettings"])).focusSettings)||void 0===o?void 0:o.focusWindowEnabled)&&await(0,n.launchFocusWindow)(),chrome.action.setBadgeText({text:"•"}),chrome.action.setBadgeBackgroundColor({color:"#1565c0"}),chrome.notifications.create({type:"basic",iconUrl:chrome.runtime.getURL("icons/icon48.png"),title:"Focus Session Started",message:t?`Focus session started for ${t} minutes. Stay focused!`:"Focus session started. Stay focused!",priority:2})},t.end=async function(e){if(e)try{const t=await chrome.tabGroups.query({}),o=await Promise.all(t.map((async e=>{const t=await chrome.tabs.query({groupId:e.id});return{groupId:e.id,title:e.title||"",color:e.color,tabUrls:t.map((e=>e.url||""))}}))),{savedWorkspaces:r}=await(0,a.getStorage)(["savedWorkspaces"]),n={name:e,tabGroups:o,timestamp:Date.now()},s=Array.isArray(r)?[...r,n]:[n];await(0,a.setStorage)({savedWorkspaces:s})}catch(e){console.error("Error saving workspace:",e)}await(0,a.setFocusState)({active:!1,endTime:void 0}),await(0,r.closeSidePanel)(),await(0,n.closeFocusWindow)(),await(0,c.ungroupAllTabs)(),chrome.action.setBadgeText({text:""}),l=!1,i&&(clearTimeout(i),i=void 0),chrome.notifications.create({type:"basic",iconUrl:chrome.runtime.getURL("icons/icon48.png"),title:"Focus Session Ended",message:"Your focus session has ended. Great job!",priority:2}),await(0,s.releaseParkedLinks)()},t.isBlocked=async function(e){const t=await(0,a.getFocusState)();return!(!t.active||(Array.isArray(t.allowedContexts)?(console.log("[FocusEngine] allowed:",t.allowedContexts,"context:",e),t.allowedContexts.includes(e)||(l=!0,chrome.action.setBadgeText({text:"!"}),chrome.action.setBadgeBackgroundColor({color:"#d32f2f"}),i&&clearTimeout(i),i=setTimeout((()=>{l&&(l=!1,chrome.action.setBadgeText({text:"•"}),chrome.action.setBadgeBackgroundColor({color:"#1565c0"}))}),3e4),0)):(console.error("[FocusEngine] allowedContexts is not an array:",t.allowedContexts),1)))},t.isActive=async function(){return(await(0,a.getFocusState)()).active},t.getTimeLeft=async function(){const{active:e,endTime:t}=await(0,a.getFocusState)();return e?t?Math.max(0,t-Date.now())/1e3:-1:0},t.restoreWorkspace=async function(e){const{savedWorkspaces:t}=await(0,a.getStorage)(["savedWorkspaces"]);if(!t)return;const o=t.find((t=>t.name===e));if(o)for(const e of o.tabGroups){const t=[];for(const o of e.tabUrls){const e=await chrome.tabs.create({url:o,active:!1});t.push(e.id)}if(t.length>0){const o=await chrome.tabs.group({tabIds:t});await chrome.tabGroups.update(o,{title:e.title||"",color:e.color})}}},t.saveCurrentWorkspace=async function(e){const t=await chrome.tabGroups.query({}),o=await Promise.all(t.map((async e=>{const t=await chrome.tabs.query({groupId:e.id});return{groupId:e.id,title:e.title||"",color:e.color,tabUrls:t.map((e=>e.url||""))}}))),{savedWorkspaces:r}=await(0,a.getStorage)(["savedWorkspaces"]),n={name:e,tabGroups:o,timestamp:Date.now()},s=Array.isArray(r)?[...r,n]:[n];await(0,a.setStorage)({savedWorkspaces:s})},t.removeWorkspace=async function(e){const{savedWorkspaces:t}=await(0,a.getStorage)(["savedWorkspaces"]);if(!t)return;const o=t.filter((t=>t.name!==e));await(0,a.setStorage)({savedWorkspaces:o})}},282:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.setSidePanelProperties=t.closeSidePanel=t.openSidePanel=void 0,t.openSidePanel=async function(){try{const e=await chrome.windows.getCurrent();await chrome.sidePanel.open({windowId:e.id}),console.log("Side panel opened successfully")}catch(e){console.error("Error opening side panel:",e)}},t.closeSidePanel=async function(){try{const e=await chrome.sidePanel.getAll();await Promise.all(e.map((e=>chrome.sidePanel.close({windowId:e.windowId})))),console.log("Side panels closed successfully")}catch(e){console.error("Error closing side panels:",e)}},t.setSidePanelProperties=async function(e,t){try{await chrome.sidePanel.setOptions({path:e,enabled:!0}),console.log("Side panel properties updated")}catch(e){console.error("Error setting side panel properties:",e)}}},545:function(e,t,o){var a=this&&this.__createBinding||(Object.create?function(e,t,o,a){void 0===a&&(a=o);var r=Object.getOwnPropertyDescriptor(t,o);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[o]}}),Object.defineProperty(e,a,r)}:function(e,t,o,a){void 0===a&&(a=o),e[a]=t[o]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)"default"!==o&&Object.prototype.hasOwnProperty.call(e,o)&&a(t,e,o);return r(t,e),t};Object.defineProperty(t,"__esModule",{value:!0});const s=o(591),c=o(8),i=o(887),l=o(569),u=n(o(170)),d=o(979),g={},m=chrome.runtime.getURL("blocked.html");async function p(){try{if(!(await(0,c.getFocusState)()).active)return void chrome.action.setBadgeText({text:""});chrome.action.setBadgeText({text:"•"}),chrome.action.setBadgeBackgroundColor({color:"#1565c0"})}catch(e){console.error("Error updating badge:",e)}}async function w(e){return(await chrome.storage.local.get([e]))[e]||{contexts:[],training:{falsePositives:[],truePositives:[]}}}async function h(e,t){await chrome.storage.local.set({[e]:t})}chrome.runtime.onMessage.addListener(((e,t,o)=>{var a,r;if("CONTEXT_UPDATE"===e.type||"CONTEXT_DETECTED"===e.type){const o=e.context,r=null===(a=t.tab)||void 0===a?void 0:a.id;return null!=r&&(g[r],g[r]=o,e.confidence,e.secondaryContexts,e.url,chrome.storage.local.set({[e.url]:{context:e.context,confidence:e.confidence}}),async function(e,t){const{autoGroupEnabled:o=!0}=await(0,c.getStorage)(["autoGroupEnabled"]);!1!==o&&(await(0,s.groupTabByContext)(e,t),p())}(r,o).catch((e=>console.error(e)))),!1}if("FOCUS_TOGGLE"===e.type)return async function(e){e?(await u.start(["Work","Development","Research","Learning"]),await(0,d.applyAllowedContexts)()):(await u.end(),await(0,d.applyAllowedContexts)())}(e.enabled).catch((e=>console.error(e))),!1;if("START_FOCUS_SESSION"===e.type){const{durationMinutes:t,allowedContexts:a}=e.payload||{};if(a)u.start(a,t).then((()=>o({success:!0}))).catch((e=>{console.error(e),o({success:!1,error:e.message})}));else{const{blockedCategories:a}=e.payload||{},r=["Work","Development","Research","Learning","Entertainment","Social","Shopping","News"].filter((e=>!(null==a?void 0:a.includes(e))));u.start(r,t).then((()=>o({success:!0}))).catch((e=>{console.error(e),o({success:!1,error:e.message})}))}return!0}if("END_FOCUS_SESSION"===e.type){const{saveWorkspaceName:t}=e.payload||{};return u.end(t).then((()=>o({success:!0}))).catch((e=>{console.error("Error ending focus session:",e),o({success:!1,error:e.message})})),!0}if("GET_FOCUS_TIME_LEFT"===e.type)return u.getTimeLeft().then((e=>{o({seconds:e})})).catch((e=>{console.error("Error getting focus time left:",e),o({seconds:0})})),!0;if("OVERRIDE_BLOCK"===e.type)return o({success:!0}),!0;if("RESTORE_WORKSPACE"===e.type){const{name:t}=e.payload||{};return u.restoreWorkspace(t).then((()=>o({success:!0}))).catch((e=>{console.error(e),o({success:!1,error:e.message})})),!0}if("CHECK_FOCUS_STATUS"===e.type)return(0,i.checkFocusStatus)().then((e=>o(e))).catch((e=>{console.error("Error checking focus status:",e),o(null)})),!0;if("CONTENT_SCRIPT_READY"===e.type)return null===(r=t.tab)||void 0===r||r.id,o({success:!0}),!0;if("TIMER_EXPIRED"===e.type)return chrome.tabs.query({active:!0,currentWindow:!0},(e=>{e[0]&&e[0].id&&chrome.tabs.sendMessage(e[0].id,{type:"DRIFT_WARNING",message:"Time's up! Return to your primary task now."},(t=>{(chrome.runtime.lastError||void 0===t)&&chrome.tabs.update(e[0].id,{url:m})}))})),o({success:!0}),!0;if("PARK_LINK"===e.type){const{url:t,context:o,title:a}=e;return(async()=>{try{await(0,l.saveForLater)(t,o,a),console.log(`[Parked Links] Saved for later: ${a||t} (${o})`)}catch(e){console.error("Error parking link:",e)}})(),!1}return"RELEASE_PARKED_LINKS"===e.type?((async()=>{try{await(0,l.releaseParkedLinks)(),o({success:!0})}catch(e){console.error("Error releasing parked links:",e),o({success:!1,error:String(e)})}})(),!0):"TRAIN_CONTEXT"===e.type?((async()=>{const{url:t,title:a,actualContext:r,predictedContext:n,isFalsePositive:s}=e,c=await w(t);c.training||(c.training={falsePositives:[],truePositives:[]}),s?c.training.falsePositives.push({timestamp:Date.now(),actualContext:r,predictedContext:n}):c.training.truePositives.push({timestamp:Date.now(),actualContext:r,predictedContext:n}),await h(t,c),await async function(e){const t=await w(e),{training:o}=t;if(!o)return;const a={};o.falsePositives.forEach((e=>{a[e.predictedContext]=.9*(a[e.predictedContext]||1)})),o.truePositives.forEach((e=>{a[e.predictedContext]=1.1*(a[e.predictedContext]||1)})),t.weights=a,await h(e,t)}(t),o({success:!0})})(),!0):"STAY_FOCUSED_ACTION"===e.type?((async()=>{const{url:t,context:a,title:r}=e.payload;try{await(0,l.saveForLater)(t,a,r);const[e]=await chrome.tabs.query({active:!0,currentWindow:!0});(null==e?void 0:e.id)&&await(0,l.goBackOrClose)(e.id),o({success:!0})}catch(e){console.error("Stay‑focused flow failed:",e),o({success:!1,error:e instanceof Error?e.message:String(e)})}})(),!0):"FOCUS_STATUS"===e.type&&((0,c.getFocusState)().then((e=>o(e))).catch((e=>{console.error("Error getting focus status:",e),o(null)})),!0)})),(0,s.onTabRemoved)((e=>{delete g[e]})),chrome.storage.onChanged.addListener((async e=>{e.focusState&&await(0,d.applyAllowedContexts)()})),chrome.runtime.onInstalled.addListener((e=>{"install"===e.reason?(chrome.storage.local.set({extensionEnabled:!0,autoGroupEnabled:!0,focusState:{active:!1,allowedContexts:[]},firstRunComplete:!1}),chrome.tabs.create({url:chrome.runtime.getURL("onboarding.html")})):"update"===e.reason&&chrome.storage.local.get(["autoGroupEnabled","focusSessionActive","focusSessionEndTime","blockedCategories","focusState"],(e=>{const t={extensionEnabled:!0};if(!e.focusState&&(e.focusSessionActive||e.blockedCategories)){console.log("Migrating from old focus session format to new focusState format");const o=["Work","Development","Research","Learning","Entertainment","Social","Shopping","News"],a=e.blockedCategories||[],r=o.filter((e=>!a.includes(e)));t.focusState={active:!0===e.focusSessionActive,allowedContexts:r,endTime:e.focusSessionEndTime||void 0},chrome.storage.local.remove(["focusSessionActive","focusSessionEndTime","blockedCategories"])}void 0===e.autoGroupEnabled&&(t.autoGroupEnabled=!0),chrome.storage.local.set(t)}))})),async function(){await(0,c.setStorage)({extensionEnabled:!0}),console.log("[Background] Extension enabled.");const e=await(0,c.getFocusState)();e.active&&(console.log("[Background] Focus session was active at shutdown, verifying..."),!e.endTime||e.endTime<=Date.now()?(console.log("[Background] Focus session expired during shutdown, cleaning up"),await(0,c.setFocusState)({active:!1,endTime:void 0})):(console.log(`[Background] Focus session continues until ${new Date(e.endTime).toLocaleTimeString()}`),await(0,d.applyAllowedContexts)())),chrome.alarms.create("focusTick",{periodInMinutes:1}),chrome.alarms.create("focusDrift",{periodInMinutes:2}),chrome.alarms.onAlarm.addListener((async({name:e})=>{try{if("focusTick"===e)await async function(){const e=(await(0,c.getFocusState)()).endTime;e&&Date.now()>=e&&await u.isActive()&&(await u.end(),console.log("[Focus] Session ended automatically due to timeout"),chrome.notifications.create({type:"basic",iconUrl:chrome.runtime.getURL("icons/icon48.png"),title:"Focus Session Complete",message:"Your timed focus session has ended."}))}();else if("focusDrift"===e&&await u.isActive()){const e=await(0,i.checkFocusStatus)();e.isLostFocus&&await async function(e){var t,o;try{if(!await u.isActive())return;console.log("[Focus] Sending drift warning to active tab",e);const a=await chrome.tabs.query({active:!0,currentWindow:!0});if(!a.length||!a[0].id)return;const r=a[0],n=r.id;if((null===(t=r.url)||void 0===t?void 0:t.startsWith("chrome://"))||(null===(o=r.url)||void 0===o?void 0:o.startsWith("chrome-extension://")))return;let s="YOU'RE DRIFTING FROM YOUR FOCUS TASK!";if(e.contextSwitches.length>0){const t=e.contextSwitches[e.contextSwitches.length-1];s=`FOCUS LOST: Switched from ${t.from} to ${t.to}`}chrome.tabs.sendMessage(n,{type:"DRIFT_WARNING",message:s},(e=>{(chrome.runtime.lastError||void 0===e)&&chrome.tabs.update(n,{url:m})})),chrome.notifications.create({type:"basic",iconUrl:chrome.runtime.getURL("icons/icon48.png"),title:"FOCUS ALERT!",message:s,priority:2,requireInteraction:!0}),console.log("[Focus] Drift warning sent successfully")}catch(e){console.error("Error sending drift warning:",e)}}(e)}await p()}catch(t){console.error(`Error in alarm handler (${e}):`,t)}}))}().catch(console.error)},569:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.clearParkedLinks=t.showToast=t.goBackOrClose=t.releaseParkedLinks=t.getParkedLinks=t.saveForLater=void 0;const a=o(8);async function r(){const{parkedLinks:e=[]}=await(0,a.getStorage)(["parkedLinks"]);return e}async function n(e,t){try{const o=await chrome.tabs.query({windowId:t.windowId});if(o.length>1){const t=o.findIndex((t=>t.id===e)),a=o[t>0?t-1:(t+1)%o.length];a.id&&(await chrome.tabs.update(a.id,{active:!0}),setTimeout((()=>{chrome.tabs.remove(e).catch((e=>{console.error("Tab removal failed:",e)}))}),100))}else await chrome.tabs.update(e,{url:"about:blank"})}catch(t){console.error("Navigation fallback failed:",t);try{await chrome.tabs.update(e,{url:"about:blank"})}catch(e){console.error("Final fallback failed:",e)}}}t.saveForLater=async function(e,t,o){const{parkedLinks:r=[]}=await(0,a.getStorage)(["parkedLinks"]);if(!r.some((t=>t.url===e))){const n={url:e,title:o,context:t,timestamp:Date.now()};await(0,a.setStorage)({parkedLinks:[...r,n]})}},t.getParkedLinks=r,t.releaseParkedLinks=async function(){const e=await r();if(0===e.length)return;let t;await chrome.windows.getCurrent();try{const o=[];for(const t of e){const e=await chrome.tabs.create({url:t.url,active:!1});e.id&&o.push(e.id)}if(o.length>0)try{t=await chrome.tabs.group({tabIds:o}),t&&await chrome.tabGroups.update(t,{title:"Parked Links",color:"blue"})}catch(e){console.error("Error creating tab group:",e)}await(0,a.setStorage)({parkedLinks:[]}),chrome.notifications.create({type:"basic",iconUrl:chrome.runtime.getURL("icons/icon48.png"),title:"Parked Links Opened",message:`Opened ${e.length} links that were saved during your focus session.`})}catch(e){console.error("Error opening parked links:",e)}},t.goBackOrClose=async function(e){try{const t=await chrome.tabs.get(e);try{const o=await chrome.scripting.executeScript({target:{tabId:e},func:()=>({canGoBack:window.history.length>1,url:window.location.href})}),{canGoBack:a}=o[0].result;if(a)return void await chrome.scripting.executeScript({target:{tabId:e},func:()=>window.history.back()});await n(e,t)}catch(o){console.error("Script execution error:",o);try{await chrome.tabs.goBack(e)}catch(o){await n(e,t)}}}catch(e){console.error("Tab lookup error:",e)}},t.showToast=async function(e,t,o=3e3){try{await chrome.scripting.executeScript({target:{tabId:e},func:(e,t)=>{const o=document.createElement("div");o.style.cssText="\n          position: fixed;\n          bottom: 20px;\n          right: 20px;\n          background-color: rgba(0, 102, 204, 0.9);\n          color: white;\n          padding: 12px 20px;\n          border-radius: 4px;\n          box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);\n          font-family: Arial, sans-serif;\n          z-index: 2147483647;\n          max-width: 300px;\n          transition: opacity 0.3s ease-in-out;\n        ",o.textContent=e,document.body.appendChild(o),setTimeout((()=>{o.style.opacity="0",setTimeout((()=>o.remove()),300)}),t-300)},args:[t,o]})}catch(e){console.error("Error showing toast:",e)}},t.clearParkedLinks=async function(){await(0,a.setStorage)({parkedLinks:[]})}},591:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ungroupAllTabs=t.onTabRemoved=t.groupTabByContext=void 0;const a=o(56);t.groupTabByContext=async function(e,t){let o=(await chrome.tabGroups.query({})).find((e=>e.title===t));if(o)await chrome.tabs.group({groupId:o.id,tabIds:[e]});else{const r=await chrome.tabs.group({tabIds:[e]});o=await chrome.tabGroups.update(r,{title:t,color:(0,a.pickColorForContext)(t)})}},t.onTabRemoved=function(e){chrome.tabs.onRemoved.addListener(e)},t.ungroupAllTabs=async function(){const e=await chrome.tabGroups.query({});for(const t of e){const e=await chrome.tabs.query({groupId:t.id});e.length&&await chrome.tabs.ungroup(e.map((e=>e.id)))}}},887:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.showFocusNotification=t.checkFocusStatus=t.getContextSwitches=t.updateFocusSettings=t.getFocusSettings=void 0;const a=o(8),r={enabled:!0,notificationsEnabled:!0,switchThreshold:5,timeWindowMinutes:15};async function n(){const{focusSettings:e}=await(0,a.getStorage)(["focusSettings"]);return Object.assign(Object.assign({},r),e)}async function s(e=15){const{contextHistory:t}=await(0,a.getStorage)(["contextHistory"]);if(!t||t.length<2)return[];const o=[],r=Date.now(),n=60*e*1e3,s=t.filter((e=>r-e.timestamp<n));for(let e=1;e<s.length;e++)s[e].context!==s[e-1].context&&o.push({from:s[e-1].context,to:s[e].context,timestamp:s[e].timestamp,fromUrl:s[e-1].url,toUrl:s[e].url});return o}t.getFocusSettings=n,t.updateFocusSettings=async function(e){const t=await n();await(0,a.setStorage)({focusSettings:Object.assign(Object.assign({},t),e)})},t.getContextSwitches=s,t.checkFocusStatus=async function(){const e=await n(),t=await s(e.timeWindowMinutes);let o="Unknown",r=1;const{contextHistory:c}=await(0,a.getStorage)(["contextHistory"]);if(c&&c.length>0){o=c[c.length-1].context;let e=c.length-1;for(;e>0&&c[e].context===o;)r++,e--}return{isLostFocus:t.length>=e.switchThreshold,contextSwitches:t,currentStreak:r,currentContext:o}},t.showFocusNotification=function(e){chrome.notifications.create({type:"basic",iconUrl:chrome.runtime.getURL("icons/icon48.png"),title:"Focus Alert",message:`You've switched contexts ${e.length} times recently. Try to maintain focus.`,buttons:[{title:"View Details"}]})}},979:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.applyAllowedContexts=void 0;const a=o(8),r=chrome.runtime.getURL("blocked.html");async function n(){return(await chrome.declarativeNetRequest.getDynamicRules()).map((e=>e.id))}t.applyAllowedContexts=async function(){try{const e=await(0,a.getFocusState)();if(!e.active)return void await chrome.declarativeNetRequest.updateDynamicRules({removeRuleIds:await n()});const{domainContextMap:t}=await chrome.storage.local.get("domainContextMap");if(!t)return void console.warn("No domain context map found, cannot create blocking rules");const o={};for(const[e,a]of Object.entries(t))o[a]||(o[a]=[]),o[a].push(e);const s=[],c=["Work","Development","Research","Learning","Entertainment","Social","Shopping","News"].filter((t=>!e.allowedContexts.includes(t)));let i=100;for(const e of c){const t=o[e]||[];if(0!==t.length&&(s.push({id:i++,priority:1,action:{type:chrome.declarativeNetRequest.RuleActionType.REDIRECT,redirect:{url:r}},condition:{urlFilter:t.join("|"),resourceTypes:[chrome.declarativeNetRequest.ResourceType.MAIN_FRAME]}}),s.length>=5e3)){console.warn("Hit DNR rule limit of 5000");break}}await chrome.declarativeNetRequest.updateDynamicRules({removeRuleIds:await n(),addRules:s}),console.log(`[DNR] Applied ${s.length} blocking rules for ${c.length} contexts`)}catch(e){console.error("Error applying DNR rules:",e)}}}},t={};!function o(a){var r=t[a];if(void 0!==r)return r.exports;var n=t[a]={exports:{}};return e[a].call(n.exports,n,n.exports,o),n.exports}(545)})();
//# sourceMappingURL=background.js.map