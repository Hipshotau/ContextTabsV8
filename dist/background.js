(()=>{"use strict";var e={8:(e,t)=>{function o(e){return new Promise(((t,o)=>{chrome.storage.local.get(e,(e=>{if(chrome.runtime.lastError)return o(chrome.runtime.lastError);t(e)}))}))}function n(e){return new Promise(((t,o)=>{chrome.storage.local.set(e,(()=>{if(chrome.runtime.lastError)return o(chrome.runtime.lastError);t()}))}))}async function a(){const{focusState:e}=await o(["focusState"]);return Object.assign(Object.assign({},{active:!1,allowedContexts:[]}),e)}Object.defineProperty(t,"__esModule",{value:!0}),t.setFocusState=t.getFocusState=t.addContextToHistory=t.setStorage=t.getStorage=void 0,t.getStorage=o,t.setStorage=n,t.addContextToHistory=async function(e,t,a){const{contextHistory:r}=await o(["contextHistory"]),c=r||[];c.push({context:e,url:t,timestamp:Date.now(),confidence:a}),c.length>100&&c.shift(),await n({contextHistory:c})},t.getFocusState=a,t.setFocusState=async function(e){const t=await a();await n({focusState:Object.assign(Object.assign({},t),e)})}},18:(e,t)=>{let o;async function n(){try{if(void 0!==o)try{return await chrome.windows.get(o),o}catch(e){o=void 0}const{id:e}=await chrome.windows.create({url:"about:blank",type:"normal",state:"maximized"});if(o=e,e){const t=await chrome.tabs.query({windowId:e});t.length>0&&t[0].id&&await chrome.tabs.update(t[0].id,{url:chrome.runtime.getURL("blocked.html")+"?mode=welcome"})}return o}catch(e){return void console.error("Error launching focus window:",e)}}Object.defineProperty(t,"__esModule",{value:!0}),t.moveTabToFocusWindow=t.getFocusWindowId=t.closeFocusWindow=t.launchFocusWindow=void 0,t.launchFocusWindow=n,t.closeFocusWindow=async function(){if(void 0!==o)try{await chrome.windows.remove(o),o=void 0}catch(e){console.error("Error closing focus window:",e),o=void 0}},t.getFocusWindowId=function(){return o},t.moveTabToFocusWindow=async function(e){if(void 0===o&&void 0===await n())return!1;try{return await chrome.tabs.move(e,{windowId:o,index:-1}),!0}catch(e){return console.error("Error moving tab to focus window:",e),!1}}},56:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.pickColorForContext=void 0,t.pickColorForContext=function(e){switch(e){case"Work":return"yellow";case"Learning":return"blue";case"Entertainment":return"green";case"News":return"red";case"Shopping":return"purple";case"Social":return"cyan";case"Research":return"pink";case"Development":return"orange";default:return"grey"}}},170:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.removeWorkspace=t.saveCurrentWorkspace=t.restoreWorkspace=t.getTimeLeft=t.isActive=t.isBlocked=t.end=t.start=void 0;const n=o(8),a=o(282),r=o(18),c=o(569),s=o(591);let i,l=!1;t.start=async function(e,t){var o;const c=Array.isArray(e)?e:[],s=t?Date.now()+60*t*1e3:void 0;await(0,n.setFocusState)({active:!0,allowedContexts:c,endTime:s});const i=["Work","Development","Research","Learning","Entertainment","Social","Shopping","News"].filter((e=>!c.includes(e)));await(0,n.setStorage)({blockedCategories:i}),await(0,a.openSidePanel)(),!!(null===(o=(await(0,n.getStorage)(["focusSettings"])).focusSettings)||void 0===o?void 0:o.focusWindowEnabled)&&await(0,r.launchFocusWindow)(),chrome.action.setBadgeText({text:"•"}),chrome.action.setBadgeBackgroundColor({color:"#1565c0"}),chrome.notifications.create({type:"basic",iconUrl:chrome.runtime.getURL("icons/icon48.png"),title:"Focus Session Started",message:t?`Focus session started for ${t} minutes. Stay focused!`:"Focus session started. Stay focused!",priority:2})},t.end=async function(e){if(e)try{const t=await chrome.tabGroups.query({}),o=await Promise.all(t.map((async e=>{const t=await chrome.tabs.query({groupId:e.id});return{groupId:e.id,title:e.title||"",color:e.color,tabUrls:t.map((e=>e.url||""))}}))),{savedWorkspaces:a}=await(0,n.getStorage)(["savedWorkspaces"]),r={name:e,tabGroups:o,timestamp:Date.now()},c=Array.isArray(a)?[...a,r]:[r];await(0,n.setStorage)({savedWorkspaces:c})}catch(e){console.error("Error saving workspace:",e)}await(0,n.setFocusState)({active:!1,endTime:void 0}),await(0,a.closeSidePanel)(),await(0,r.closeFocusWindow)(),await(0,s.ungroupAllTabs)(),chrome.action.setBadgeText({text:""}),l=!1,i&&(clearTimeout(i),i=void 0),chrome.notifications.create({type:"basic",iconUrl:chrome.runtime.getURL("icons/icon48.png"),title:"Focus Session Ended",message:"Your focus session has ended. Great job!",priority:2}),await(0,c.releaseParkedLinks)()},t.isBlocked=async function(e){const t=await(0,n.getFocusState)();return!(!t.active||(Array.isArray(t.allowedContexts)?(console.log("[FocusEngine] allowed:",t.allowedContexts,"context:",e),t.allowedContexts.includes(e)||(l=!0,chrome.action.setBadgeText({text:"!"}),chrome.action.setBadgeBackgroundColor({color:"#d32f2f"}),i&&clearTimeout(i),i=setTimeout((()=>{l&&(l=!1,chrome.action.setBadgeText({text:"•"}),chrome.action.setBadgeBackgroundColor({color:"#1565c0"}))}),3e4),0)):(console.error("[FocusEngine] allowedContexts is not an array:",t.allowedContexts),1)))},t.isActive=async function(){return(await(0,n.getFocusState)()).active},t.getTimeLeft=async function(){const{active:e,endTime:t}=await(0,n.getFocusState)();return e?t?Math.max(0,t-Date.now())/1e3:-1:0},t.restoreWorkspace=async function(e){const{savedWorkspaces:t}=await(0,n.getStorage)(["savedWorkspaces"]);if(!t)return;const o=t.find((t=>t.name===e));if(o)for(const e of o.tabGroups){const t=[];for(const o of e.tabUrls){const e=await chrome.tabs.create({url:o,active:!1});t.push(e.id)}if(t.length>0){const o=await chrome.tabs.group({tabIds:t});await chrome.tabGroups.update(o,{title:e.title||"",color:e.color})}}},t.saveCurrentWorkspace=async function(e){const t=await chrome.tabGroups.query({}),o=await Promise.all(t.map((async e=>{const t=await chrome.tabs.query({groupId:e.id});return{groupId:e.id,title:e.title||"",color:e.color,tabUrls:t.map((e=>e.url||""))}}))),{savedWorkspaces:a}=await(0,n.getStorage)(["savedWorkspaces"]),r={name:e,tabGroups:o,timestamp:Date.now()},c=Array.isArray(a)?[...a,r]:[r];await(0,n.setStorage)({savedWorkspaces:c})},t.removeWorkspace=async function(e){const{savedWorkspaces:t}=await(0,n.getStorage)(["savedWorkspaces"]);if(!t)return;const o=t.filter((t=>t.name!==e));await(0,n.setStorage)({savedWorkspaces:o})}},282:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.setSidePanelProperties=t.closeSidePanel=t.openSidePanel=void 0,t.openSidePanel=async function(){try{const e=await chrome.windows.getCurrent();await chrome.sidePanel.open({windowId:e.id}),console.log("Side panel opened successfully")}catch(e){console.error("Error opening side panel:",e)}},t.closeSidePanel=async function(){try{const e=await chrome.sidePanel.getAll();await Promise.all(e.map((e=>chrome.sidePanel.close({windowId:e.windowId})))),console.log("Side panels closed successfully")}catch(e){console.error("Error closing side panels:",e)}},t.setSidePanelProperties=async function(e,t){try{await chrome.sidePanel.setOptions({path:e,enabled:!0}),console.log("Side panel properties updated")}catch(e){console.error("Error setting side panel properties:",e)}}},309:(e,t)=>{function o(e){try{return new URL(e).hostname}catch(e){return console.error("Error extracting domain:",e),""}}function n(e){if(t.DOMAIN_CATEGORIES[e])return t.DOMAIN_CATEGORIES[e];if(e.startsWith("www.")){const o=e.substring(4);if(t.DOMAIN_CATEGORIES[o])return t.DOMAIN_CATEGORIES[o]}const o=e.split(".");if(o.length>2){const e=o.slice(o.length-2).join(".");return t.DOMAIN_CATEGORIES[e]}}function a(e){try{return new URL(e).pathname.split("/").filter(Boolean).flatMap((e=>e.split(/[-_]/).filter((e=>e.length>2))))}catch(e){return console.error("Error extracting path keywords:",e),[]}}Object.defineProperty(t,"__esModule",{value:!0}),t.analyzeUrl=t.extractPathKeywords=t.getDomainCategory=t.extractDomain=t.DOMAIN_CATEGORIES=void 0,t.DOMAIN_CATEGORIES={"docs.google.com":"Work","sheets.google.com":"Work","slides.google.com":"Work","drive.google.com":"Work","office.com":"Work","microsoft365.com":"Work","linkedin.com":"Work","slack.com":"Work","teams.microsoft.com":"Work","asana.com":"Work","trello.com":"Work","notion.so":"Work","monday.com":"Work","atlassian.com":"Work","jira.com":"Work","basecamp.com":"Work","zoom.us":"Work","coursera.org":"Learning","udemy.com":"Learning","edx.org":"Learning","khanacademy.org":"Learning","duolingo.com":"Learning","canvas.instructure.com":"Learning","blackboard.com":"Learning","quizlet.com":"Learning","chegg.com":"Learning","brilliant.org":"Learning","codecademy.com":"Learning","freecodecamp.org":"Learning","lynda.com":"Learning","skillshare.com":"Learning","pluralsight.com":"Learning","netflix.com":"Entertainment","hulu.com":"Entertainment","disneyplus.com":"Entertainment","hbomax.com":"Entertainment","youtube.com":"Entertainment","twitch.tv":"Entertainment","spotify.com":"Entertainment","pandora.com":"Entertainment","tidal.com":"Entertainment","soundcloud.com":"Entertainment","steam.com":"Entertainment","epicgames.com":"Entertainment","ign.com":"Entertainment","imdb.com":"Entertainment","rottentomatoes.com":"Entertainment","cnn.com":"News","bbc.com":"News","nytimes.com":"News","washingtonpost.com":"News","reuters.com":"News","apnews.com":"News","foxnews.com":"News","nbcnews.com":"News","abcnews.go.com":"News","cbsnews.com":"News","politico.com":"News","economist.com":"News","wsj.com":"News","bloomberg.com":"News","theguardian.com":"News","github.com":"Development","gitlab.com":"Development","bitbucket.org":"Development","stackoverflow.com":"Development","developer.mozilla.org":"Development","w3schools.com":"Development","codepen.io":"Development","replit.com":"Development","codesandbox.io":"Development","jsfiddle.net":"Development","npmjs.com":"Development","pypi.org":"Development","docker.com":"Development","kubernetes.io":"Development","digitalocean.com":"Development","amazon.com":"Shopping","ebay.com":"Shopping","walmart.com":"Shopping","target.com":"Shopping","bestbuy.com":"Shopping","etsy.com":"Shopping","aliexpress.com":"Shopping","wayfair.com":"Shopping","costco.com":"Shopping","newegg.com":"Shopping","homedepot.com":"Shopping","lowes.com":"Shopping","macys.com":"Shopping","nordstrom.com":"Shopping","zappos.com":"Shopping","facebook.com":"Social","twitter.com":"Social","instagram.com":"Social","reddit.com":"Social","pinterest.com":"Social","tumblr.com":"Social","tiktok.com":"Social","snapchat.com":"Social","discord.com":"Social","messenger.com":"Social","telegram.org":"Social","whatsapp.com":"Social","signal.org":"Social","medium.com":"Social","quora.com":"Social","scholar.google.com":"Research","pubmed.ncbi.nlm.nih.gov":"Research","researchgate.net":"Research","academia.edu":"Research","jstor.org":"Research","springer.com":"Research","sciencedirect.com":"Research","ieee.org":"Research","ncbi.nlm.nih.gov":"Research","arxiv.org":"Research","sciencemag.org":"Research","nature.com":"Research","webofknowledge.com":"Research","scopus.com":"Research","mendeley.com":"Research"},t.extractDomain=o,t.getDomainCategory=n,t.extractPathKeywords=a,t.analyzeUrl=function(e){const t=n(o(e)),r=(a(e),{});return t&&(r[t]=.8),r}},545:function(e,t,o){var n=this&&this.__createBinding||(Object.create?function(e,t,o,n){void 0===n&&(n=o);var a=Object.getOwnPropertyDescriptor(t,o);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[o]}}),Object.defineProperty(e,n,a)}:function(e,t,o,n){void 0===n&&(n=o),e[n]=t[o]}),a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)"default"!==o&&Object.prototype.hasOwnProperty.call(e,o)&&n(t,e,o);return a(t,e),t};Object.defineProperty(t,"__esModule",{value:!0});const c=o(591),s=o(8),i=o(887),l=o(309),u=o(569),d=r(o(170)),m=o(979),g={},p=chrome.runtime.getURL("blocked.html"),h=new Set;async function w(){try{if(!(await(0,s.getFocusState)()).active)return void chrome.action.setBadgeText({text:""});chrome.action.setBadgeText({text:"•"}),chrome.action.setBadgeBackgroundColor({color:"#1565c0"})}catch(e){console.error("Error updating badge:",e)}}async function f(e){return(await chrome.storage.local.get([e]))[e]||{contexts:[],training:{falsePositives:[],truePositives:[]}}}async function y(e,t){await chrome.storage.local.set({[e]:t})}chrome.runtime.onMessage.addListener(((e,t,o)=>{var n,a;if("CONTEXT_UPDATE"===e.type||"CONTEXT_DETECTED"===e.type){const o=e.context,a=null===(n=t.tab)||void 0===n?void 0:n.id;if(null!=a){g[a],g[a]=o;const t={context:o,confidence:e.confidence,secondaryContexts:e.secondaryContexts,url:e.url};chrome.storage.local.set({[e.url]:{context:e.context,confidence:e.confidence}}),async function(e,t,o){const{autoGroupEnabled:n=!0}=await(0,s.getStorage)(["autoGroupEnabled"]);if(!1===n)return;await(0,c.groupTabByContext)(e,t),w();const a=(0,l.extractDomain)((null==o?void 0:o.url)||"");if(a){const{domainContextMap:n={}}=await chrome.storage.local.get("domainContextMap");if(n[a]!==t&&(n[a]=t,await chrome.storage.local.set({domainContextMap:n}),await(0,m.applyAllowedContexts)(),await d.isBlocked(t))){const n=(null==o?void 0:o.url)||"",a=chrome.runtime.getURL("blocked.html")+`?context=${encodeURIComponent(t)}&url=${encodeURIComponent(n)}`;chrome.tabs.update(e,{url:a})}}}(a,o,t).catch((e=>console.error(e)))}return!1}if("FOCUS_TOGGLE"===e.type)return async function(e){e?(await d.start(["Work","Development","Research","Learning"]),await(0,m.applyAllowedContexts)()):(await d.end(),await(0,m.applyAllowedContexts)())}(e.enabled).catch((e=>console.error(e))),!1;if("START_FOCUS_SESSION"===e.type){const{durationMinutes:t,allowedContexts:n}=e.payload||{};if(n)d.start(n,t).then((()=>o({success:!0}))).catch((e=>{console.error(e),o({success:!1,error:e.message})}));else{const{blockedCategories:n}=e.payload||{},a=["Work","Development","Research","Learning","Entertainment","Social","Shopping","News"].filter((e=>!(null==n?void 0:n.includes(e))));d.start(a,t).then((()=>o({success:!0}))).catch((e=>{console.error(e),o({success:!1,error:e.message})}))}return!0}if("END_FOCUS_SESSION"===e.type){const{saveWorkspaceName:t}=e.payload||{};return d.end(t).then((()=>o({success:!0}))).catch((e=>{console.error("Error ending focus session:",e),o({success:!1,error:e.message})})),!0}if("GET_FOCUS_TIME_LEFT"===e.type)return d.getTimeLeft().then((e=>{o({seconds:e})})).catch((e=>{console.error("Error getting focus time left:",e),o({seconds:0})})),!0;if("OVERRIDE_BLOCK"===e.type)return(async()=>{var e;try{const n=null===(e=t.tab)||void 0===e?void 0:e.id;n?(h.add(n),setTimeout((()=>{h.delete(n)}),5e3),o({success:!0})):o({success:!0})}catch(e){console.error("Error handling override:",e),o({success:!0})}})(),!0;if("RESTORE_WORKSPACE"===e.type){const{name:t}=e.payload||{};return d.restoreWorkspace(t).then((()=>o({success:!0}))).catch((e=>{console.error(e),o({success:!1,error:e.message})})),!0}if("CHECK_FOCUS_STATUS"===e.type)return(0,i.checkFocusStatus)().then((e=>o(e))).catch((e=>{console.error("Error checking focus status:",e),o(null)})),!0;if("CONTENT_SCRIPT_READY"===e.type)return null===(a=t.tab)||void 0===a||a.id,o({success:!0}),!0;if("TIMER_EXPIRED"===e.type)return chrome.tabs.query({active:!0,currentWindow:!0},(e=>{e[0]&&e[0].id&&chrome.tabs.sendMessage(e[0].id,{type:"DRIFT_WARNING",message:"Time's up! Return to your primary task now."},(t=>{(chrome.runtime.lastError||void 0===t)&&chrome.tabs.update(e[0].id,{url:p})}))})),o({success:!0}),!0;if("PARK_LINK"===e.type){const{url:t,context:o,title:n}=e;return(async()=>{try{await(0,u.saveForLater)(t,o,n),console.log(`[Parked Links] Saved for later: ${n||t} (${o})`)}catch(e){console.error("Error parking link:",e)}})(),!1}return"RELEASE_PARKED_LINKS"===e.type?((async()=>{try{await(0,u.releaseParkedLinks)(),o({success:!0})}catch(e){console.error("Error releasing parked links:",e),o({success:!1,error:String(e)})}})(),!0):"TRAIN_CONTEXT"===e.type?((async()=>{const{url:t,title:n,actualContext:a,predictedContext:r,isFalsePositive:c}=e,s=await f(t);s.training||(s.training={falsePositives:[],truePositives:[]}),c?s.training.falsePositives.push({timestamp:Date.now(),actualContext:a,predictedContext:r}):s.training.truePositives.push({timestamp:Date.now(),actualContext:a,predictedContext:r}),await y(t,s),await async function(e){const t=await f(e),{training:o}=t;if(!o)return;const n={};o.falsePositives.forEach((e=>{n[e.predictedContext]=.9*(n[e.predictedContext]||1)})),o.truePositives.forEach((e=>{n[e.predictedContext]=1.1*(n[e.predictedContext]||1)})),t.weights=n,await y(e,t)}(t),o({success:!0})})(),!0):"STAY_FOCUSED_ACTION"===e.type?((async()=>{const{url:t,context:n,title:a}=e.payload;try{await(0,u.saveForLater)(t,n,a);const[e]=await chrome.tabs.query({active:!0,currentWindow:!0});(null==e?void 0:e.id)&&await(0,u.goBackOrClose)(e.id),o({success:!0})}catch(e){console.error("Stay‑focused flow failed:",e),o({success:!1,error:e instanceof Error?e.message:String(e)})}})(),!0):"FOCUS_STATUS"===e.type?((0,s.getFocusState)().then((e=>o(e))).catch((e=>{console.error("Error getting focus status:",e),o(null)})),!0):"CONTEXT_OVERRIDE"===e.type&&(console.log(`Context override: ${e.domain} from ${e.originalContext} to ${e.newContext}`),o({success:!0}),!0)})),(0,c.onTabRemoved)((e=>{delete g[e]})),chrome.storage.onChanged.addListener((async e=>{e.focusState&&await(0,m.applyAllowedContexts)()})),chrome.webNavigation.onBeforeNavigate.addListener((async({tabId:e,frameId:t,url:o})=>{if(0!==t)return;if(o.startsWith(chrome.runtime.getURL(""))||"about:blank"===o)return;if(h.has(e))return void console.log(`[Block] Tab ${e} is in temporary allowlist, skipping check`);const n=await(0,s.getFocusState)();if(!n.active)return;try{if(((await chrome.tabs.get(e)).url||"").includes("blocked.html"))return console.log(`[Block] Tab ${e} coming from blocked page, allowing navigation`),h.add(e),void setTimeout((()=>{h.delete(e),console.log(`[Block] Tab ${e} removed from temporary allowlist`)}),5e3)}catch(e){}const a=(0,l.extractDomain)(o),r=((await chrome.storage.local.get("domainContextMap")).domainContextMap||{})[a];if(r&&!n.allowedContexts.includes(r)){console.log(`[Block] Blocking domain ${a} with context ${r}`);const t=chrome.runtime.getURL("blocked.html")+`?context=${encodeURIComponent(r)}&url=${encodeURIComponent(o)}`;chrome.tabs.update(e,{url:t})}})),chrome.runtime.onInstalled.addListener((e=>{"install"===e.reason?(chrome.storage.local.set({extensionEnabled:!0,autoGroupEnabled:!0,focusState:{active:!1,allowedContexts:[]},firstRunComplete:!1}),chrome.tabs.create({url:chrome.runtime.getURL("onboarding.html")})):"update"===e.reason&&chrome.storage.local.get(["autoGroupEnabled","focusSessionActive","focusSessionEndTime","blockedCategories","focusState"],(e=>{const t={extensionEnabled:!0};if(!e.focusState&&(e.focusSessionActive||e.blockedCategories)){console.log("Migrating from old focus session format to new focusState format");const o=["Work","Development","Research","Learning","Entertainment","Social","Shopping","News"],n=e.blockedCategories||[],a=o.filter((e=>!n.includes(e)));t.focusState={active:!0===e.focusSessionActive,allowedContexts:a,endTime:e.focusSessionEndTime||void 0},chrome.storage.local.remove(["focusSessionActive","focusSessionEndTime","blockedCategories"])}void 0===e.autoGroupEnabled&&(t.autoGroupEnabled=!0),chrome.storage.local.set(t)}))})),async function(){await(0,s.setStorage)({extensionEnabled:!0}),console.log("[Background] Extension enabled."),await chrome.storage.local.set({domainContextMap:l.DOMAIN_CATEGORIES});const e=await(0,s.getFocusState)();e.active?(console.log("[Background] Focus session was active at shutdown, verifying..."),!e.endTime||e.endTime<=Date.now()?(console.log("[Background] Focus session expired during shutdown, cleaning up"),await(0,s.setFocusState)({active:!1,endTime:void 0})):(console.log(`[Background] Focus session continues until ${new Date(e.endTime).toLocaleTimeString()}`),await(0,m.applyAllowedContexts)())):await(0,m.applyAllowedContexts)(),chrome.alarms.create("focusTick",{periodInMinutes:1}),chrome.alarms.create("focusDrift",{periodInMinutes:2}),chrome.alarms.onAlarm.addListener((async({name:e})=>{try{if("focusTick"===e)await async function(){const e=(await(0,s.getFocusState)()).endTime;e&&Date.now()>=e&&await d.isActive()&&(await d.end(),console.log("[Focus] Session ended automatically due to timeout"),chrome.notifications.create({type:"basic",iconUrl:chrome.runtime.getURL("icons/icon48.png"),title:"Focus Session Complete",message:"Your timed focus session has ended."}))}();else if("focusDrift"===e&&await d.isActive()){const e=await(0,i.checkFocusStatus)();e.isLostFocus&&await async function(e){var t,o;try{if(!await d.isActive())return;console.log("[Focus] Sending drift warning to active tab",e);const n=await chrome.tabs.query({active:!0,currentWindow:!0});if(!n.length||!n[0].id)return;const a=n[0],r=a.id;if((null===(t=a.url)||void 0===t?void 0:t.startsWith("chrome://"))||(null===(o=a.url)||void 0===o?void 0:o.startsWith("chrome-extension://")))return;let c="YOU'RE DRIFTING FROM YOUR FOCUS TASK!";if(e.contextSwitches.length>0){const t=e.contextSwitches[e.contextSwitches.length-1];c=`FOCUS LOST: Switched from ${t.from} to ${t.to}`}chrome.tabs.sendMessage(r,{type:"DRIFT_WARNING",message:c},(e=>{(chrome.runtime.lastError||void 0===e)&&chrome.tabs.update(r,{url:p})})),chrome.notifications.create({type:"basic",iconUrl:chrome.runtime.getURL("icons/icon48.png"),title:"FOCUS ALERT!",message:c,priority:2,requireInteraction:!0}),console.log("[Focus] Drift warning sent successfully")}catch(e){console.error("Error sending drift warning:",e)}}(e)}await w()}catch(t){console.error(`Error in alarm handler (${e}):`,t)}}))}().catch(console.error)},569:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.clearParkedLinks=t.showToast=t.goBackOrClose=t.releaseParkedLinks=t.getParkedLinks=t.saveForLater=void 0;const n=o(8);async function a(){const{parkedLinks:e=[]}=await(0,n.getStorage)(["parkedLinks"]);return e}async function r(e,t){try{const o=await chrome.tabs.query({windowId:t.windowId});if(o.length>1){const t=o.findIndex((t=>t.id===e)),n=o[t>0?t-1:(t+1)%o.length];n.id&&(await chrome.tabs.update(n.id,{active:!0}),setTimeout((()=>{chrome.tabs.remove(e).catch((e=>{console.error("Tab removal failed:",e)}))}),100))}else await chrome.tabs.update(e,{url:"about:blank"})}catch(t){console.error("Navigation fallback failed:",t);try{await chrome.tabs.update(e,{url:"about:blank"})}catch(e){console.error("Final fallback failed:",e)}}}t.saveForLater=async function(e,t,o){const{parkedLinks:a=[]}=await(0,n.getStorage)(["parkedLinks"]);if(!a.some((t=>t.url===e))){const r={url:e,title:o,context:t,timestamp:Date.now()};await(0,n.setStorage)({parkedLinks:[...a,r]})}},t.getParkedLinks=a,t.releaseParkedLinks=async function(){const e=await a();if(0===e.length)return;let t;await chrome.windows.getCurrent();try{const o=[];for(const t of e){const e=await chrome.tabs.create({url:t.url,active:!1});e.id&&o.push(e.id)}if(o.length>0)try{t=await chrome.tabs.group({tabIds:o}),t&&await chrome.tabGroups.update(t,{title:"Parked Links",color:"blue"})}catch(e){console.error("Error creating tab group:",e)}await(0,n.setStorage)({parkedLinks:[]}),chrome.notifications.create({type:"basic",iconUrl:chrome.runtime.getURL("icons/icon48.png"),title:"Parked Links Opened",message:`Opened ${e.length} links that were saved during your focus session.`})}catch(e){console.error("Error opening parked links:",e)}},t.goBackOrClose=async function(e){try{const t=await chrome.tabs.get(e);try{const o=await chrome.scripting.executeScript({target:{tabId:e},func:()=>({canGoBack:window.history.length>1,url:window.location.href})}),{canGoBack:n}=o[0].result;if(n)return void await chrome.scripting.executeScript({target:{tabId:e},func:()=>window.history.back()});await r(e,t)}catch(o){console.error("Script execution error:",o);try{await chrome.tabs.goBack(e)}catch(o){await r(e,t)}}}catch(e){console.error("Tab lookup error:",e)}},t.showToast=async function(e,t,o=3e3){try{await chrome.scripting.executeScript({target:{tabId:e},func:(e,t)=>{const o=document.createElement("div");o.style.cssText="\n          position: fixed;\n          bottom: 20px;\n          right: 20px;\n          background-color: rgba(0, 102, 204, 0.9);\n          color: white;\n          padding: 12px 20px;\n          border-radius: 4px;\n          box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);\n          font-family: Arial, sans-serif;\n          z-index: 2147483647;\n          max-width: 300px;\n          transition: opacity 0.3s ease-in-out;\n        ",o.textContent=e,document.body.appendChild(o),setTimeout((()=>{o.style.opacity="0",setTimeout((()=>o.remove()),300)}),t-300)},args:[t,o]})}catch(e){console.error("Error showing toast:",e)}},t.clearParkedLinks=async function(){await(0,n.setStorage)({parkedLinks:[]})}},591:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ungroupAllTabs=t.onTabRemoved=t.groupTabByContext=void 0;const n=o(56);t.groupTabByContext=async function(e,t){let o=(await chrome.tabGroups.query({})).find((e=>e.title===t));if(o)await chrome.tabs.group({groupId:o.id,tabIds:[e]});else{const a=await chrome.tabs.group({tabIds:[e]});o=await chrome.tabGroups.update(a,{title:t,color:(0,n.pickColorForContext)(t)})}},t.onTabRemoved=function(e){chrome.tabs.onRemoved.addListener(e)},t.ungroupAllTabs=async function(){const e=await chrome.tabGroups.query({});for(const t of e){const e=await chrome.tabs.query({groupId:t.id});e.length&&await chrome.tabs.ungroup(e.map((e=>e.id)))}}},887:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.showFocusNotification=t.checkFocusStatus=t.getContextSwitches=t.updateFocusSettings=t.getFocusSettings=void 0;const n=o(8),a={enabled:!0,notificationsEnabled:!0,switchThreshold:5,timeWindowMinutes:15};async function r(){const{focusSettings:e}=await(0,n.getStorage)(["focusSettings"]);return Object.assign(Object.assign({},a),e)}async function c(e=15){const{contextHistory:t}=await(0,n.getStorage)(["contextHistory"]);if(!t||t.length<2)return[];const o=[],a=Date.now(),r=60*e*1e3,c=t.filter((e=>a-e.timestamp<r));for(let e=1;e<c.length;e++)c[e].context!==c[e-1].context&&o.push({from:c[e-1].context,to:c[e].context,timestamp:c[e].timestamp,fromUrl:c[e-1].url,toUrl:c[e].url});return o}t.getFocusSettings=r,t.updateFocusSettings=async function(e){const t=await r();await(0,n.setStorage)({focusSettings:Object.assign(Object.assign({},t),e)})},t.getContextSwitches=c,t.checkFocusStatus=async function(){const e=await r(),t=await c(e.timeWindowMinutes);let o="Unknown",a=1;const{contextHistory:s}=await(0,n.getStorage)(["contextHistory"]);if(s&&s.length>0){o=s[s.length-1].context;let e=s.length-1;for(;e>0&&s[e].context===o;)a++,e--}return{isLostFocus:t.length>=e.switchThreshold,contextSwitches:t,currentStreak:a,currentContext:o}},t.showFocusNotification=function(e){chrome.notifications.create({type:"basic",iconUrl:chrome.runtime.getURL("icons/icon48.png"),title:"Focus Alert",message:`You've switched contexts ${e.length} times recently. Try to maintain focus.`,buttons:[{title:"View Details"}]})}},979:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.applyAllowedContexts=void 0;const n=o(8),a=chrome.runtime.getURL("blocked.html");async function r(){return(await chrome.declarativeNetRequest.getDynamicRules()).map((e=>e.id))}t.applyAllowedContexts=async function(){try{const e=await(0,n.getFocusState)();if(!e.active)return void await chrome.declarativeNetRequest.updateDynamicRules({removeRuleIds:await r()});const{domainContextMap:t}=await chrome.storage.local.get("domainContextMap");if(!t)return void console.warn("No domain context map found, cannot create blocking rules");const o={};for(const[e,n]of Object.entries(t))o[n]||(o[n]=[]),o[n].push(e);const c=[],s=["Work","Development","Research","Learning","Entertainment","Social","Shopping","News"].filter((t=>!e.allowedContexts.includes(t)));let i=100;for(const e of s){const t=o[e]||[];if(0!==t.length&&(c.push({id:i++,priority:1,action:{type:chrome.declarativeNetRequest.RuleActionType.REDIRECT,redirect:{url:a}},condition:{requestDomains:t,resourceTypes:[chrome.declarativeNetRequest.ResourceType.MAIN_FRAME],excludedInitiatorDomains:["localhost","chrome-extension"],domainType:chrome.declarativeNetRequest.DomainType.FIRST_PARTY}}),c.length>=5e3)){console.warn("Hit DNR rule limit of 5000");break}}const{pathOverrides:l=[]}=await chrome.storage.local.get("pathOverrides");for(const e of l)if(c.push({id:i++,priority:2,action:{type:chrome.declarativeNetRequest.RuleActionType.REDIRECT,redirect:{url:a}},condition:{urlFilter:`|${e}|`,resourceTypes:[chrome.declarativeNetRequest.ResourceType.MAIN_FRAME]}}),c.length>=5e3){console.warn("Hit DNR rule limit of 5000");break}await chrome.declarativeNetRequest.updateDynamicRules({removeRuleIds:await r(),addRules:c}),console.log(`[DNR] Applied ${c.length} blocking rules for ${s.length} contexts and ${l.length} path overrides`)}catch(e){console.error("Error applying DNR rules:",e)}}}},t={};!function o(n){var a=t[n];if(void 0!==a)return a.exports;var r=t[n]={exports:{}};return e[n].call(r.exports,r,r.exports,o),r.exports}(545)})();
//# sourceMappingURL=background.js.map